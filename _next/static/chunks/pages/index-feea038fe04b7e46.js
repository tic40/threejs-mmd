(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{8058:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(9915)}])},9915:(e,t,a)=>{"use strict";let n,o,i,r,s,l,d,c,m,h,u,p,f,g,w,y;a.r(t),a.d(t,{default:()=>z});var b=a(5105),x=a(8101),v=a(7869),_=a(2306),k=a(5626),j=a(6969),N=a.n(j),C=a(3380),M=a.n(C);let E=e=>{let{title:t,description:a}=e;return(0,b.jsxs)(M(),{children:[(0,b.jsx)("title",{children:t}),(0,b.jsx)("meta",{property:"description",content:a}),(0,b.jsx)("meta",{property:"og:title",content:t}),(0,b.jsx)("meta",{property:"og:description",content:a}),(0,b.jsx)("meta",{property:"og:image",content:"https://avatars.githubusercontent.com/u/739402?v=4?s=400"}),(0,b.jsx)("meta",{name:"twitter:card",content:"summary"}),(0,b.jsx)("link",{rel:"icon",href:"".concat("/threejs-mmd/","/favicon.ico")})]})};var P=a(4723),S=a(7284);let F=[{name:"lat_miku",path:"./models/lat_miku/Lat式ミクVer2.31_White.pmd",height:1.58,emissiveMag:0},{name:"alicia",path:"./models/alicia/Alicia_solid.pmx",height:1.48,emissiveMag:-1}],A=[{name:"bonyari",path:"./motions/bonyari.vmd"},{name:"gokigen",path:"./motions/gokigen.vmd"},{name:"atamawokaku",path:"./motions/atamawokaku.vmd"},{name:"nekomimi_switch",path:"./motions/nekomimi_lat.vmd"},{name:"schrodingeiger_no_koneko",path:"./motions/Schrodingeiger_no_Koneko1.vmd"}];var R=a(9077);let z=()=>{let e=(0,x.useRef)(null),[t,a]=(0,x.useState)(!1);async function j(){a(!0),function(){for(var t;null===(t=e.current)||void 0===t?void 0:t.firstChild;)e.current.removeChild(e.current.firstChild)}();try{var t;l=new v.Z58,d=new v.zD7,c=new P.$,m=new S.a,(s=new _.JeP).setPixelRatio(window.devicePixelRatio),s.setSize(i,r),s.setClearColor(0xffffff,1),s.shadowMap.enabled=!0,null===(t=e.current)||void 0===t||t.appendChild(s.domElement),h=new v.ubm(45,i/r,.1,100),l.add(new v.$p8(0xffffff,2.2)),(p=new v.ZyN(0xffe2b9,2)).position.set(2,4,2),p.castShadow=!0,l.add(p),(u=new v.eaF(new v.bdM(10,10,1,1),new v.q2({opacity:.2}))).rotation.x=-Math.PI/2,u.receiveShadow=!0,l.add(u),l.add(new v.fTw(10,20,0,0x999999)),l.add(new v.IzY(10)),(f=new R.N(h,s.domElement)).enableDamping=!0,await N()(),await C(),await M()}catch(e){alert("error occurred!");return}finally{a(!1)}z()}async function C(){return new Promise((e,t)=>{let a=F[w];if(o[a.name])return e();m.load(a.path,t=>{t.castShadow=!0;let n=new v.NRn().setFromObject(t);t.scale.multiplyScalar(a.height/n.max.y),t.material.forEach(e=>{e.emissive.multiplyScalar(a.emissiveMag)}),o[a.name]=t,e()},e=>console.info("[model] ".concat(e.loaded/e.total*100,"% loaded")),e=>t(e))})}async function M(){return new Promise((e,t)=>{var a;let n=F[w],i=A[y];a=o[n.name],g=k.o8(a),m.loadAnimation(i.path,g,a=>{if(c.meshes.length)return e();try{c.add(g,{animation:a,physics:!0})}catch(e){console.error(e),t(e);return}l.add(g),f.target.set(0,n.height/2,0),f.object.position.set(0,.55*n.height,1.9*n.height),e()},e=>console.info("[motion] ".concat(e.loaded/e.total*100,"% loaded")),e=>t(e))})}function z(){let e=()=>{c.update(d.getDelta()),f.update(),s.render(l,h),n=requestAnimationFrame(e)};e()}async function D(){w=(w+1)%F.length,T()}async function O(){y=(y+1)%A.length,T()}async function T(){a(!0),c.remove(g),l.remove(g),cancelAnimationFrame(n);try{await C(),await M()}catch(e){j();return}finally{a(!1)}z()}return(0,x.useEffect)(()=>{i=window.innerWidth,r=window.innerHeight,o||(o={}),w||(w=0),y||(y=Math.floor(Math.random()*A.length)),j()},[]),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(E,{title:"tic40/threejs-mmd",description:"tic40/threejs-mmd"}),(0,b.jsx)("div",{className:"absolute top-1/2 left-1/2 animate-ping h-5 w-5 bg-gray-600 rounded-full",role:"status",style:{display:t?"block":"none"}}),(0,b.jsx)("button",{onClick:D,className:"absolute top-2 left-2 bg-transparent hover:text-gray-500 text-gray-700 py-1 px-1 border rounded",disabled:t,children:"Model >>"}),(0,b.jsx)("button",{onClick:O,className:"absolute top-2 left-24 bg-transparent hover:text-gray-500 text-gray-700 py-1 px-1 border rounded",disabled:t,children:"Motion >>"}),(0,b.jsx)("a",{className:"absolute bottom-2 left-2 bg-transparent text-gray-700 py-1 px-1 noborder rounded",href:"https://github.com/tic40/threejs-mmd",target:"_blank",rel:"noreferrer",children:"GitHub"}),(0,b.jsx)("div",{ref:e})]})}},1604:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[964,208,737,834,636,593,792],()=>t(8058)),_N_E=e.O()}]);