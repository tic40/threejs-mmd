(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,n,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(7761)}])},7761:function(e,n,a){"use strict";let o,i,r,s,l,d,c,m,h,u,p,g,w,f,y,b;a.r(n),a.d(n,{default:function(){return pages}});var x=a(5893),v=a(7294),_=a(9477),k=a(2274),j=a(5414),M=a.n(j),C=a(9008),S=a.n(C),meta=e=>{let{title:n,description:a}=e;return(0,x.jsxs)(S(),{children:[(0,x.jsx)("title",{children:n}),(0,x.jsx)("meta",{property:"description",content:a}),(0,x.jsx)("meta",{property:"og:title",content:n}),(0,x.jsx)("meta",{property:"og:description",content:a}),(0,x.jsx)("meta",{property:"og:image",content:"https://avatars.githubusercontent.com/u/739402?v=4?s=400"}),(0,x.jsx)("meta",{name:"twitter:card",content:"summary"}),(0,x.jsx)("link",{rel:"icon",href:"".concat("/threejs-mmd/","/favicon.ico")})]})},E=a(2125),N=a(410);let P=[{name:"lat_miku",path:"./models/lat_miku/Lat式ミクVer2.31_White.pmd",height:1.58,emissiveMag:0},{name:"alicia",path:"./models/alicia/Alicia_solid.pmx",height:1.48,emissiveMag:-1}],F=[{name:"bonyari",path:"./motions/bonyari.vmd"},{name:"gokigen",path:"./motions/gokigen.vmd"},{name:"atamawokaku",path:"./motions/atamawokaku.vmd"},{name:"nekomimi_switch",path:"./motions/nekomimi_lat.vmd"},{name:"schrodingeiger_no_koneko",path:"./motions/Schrodingeiger_no_Koneko1.vmd"}];var A=a(9365),pages=()=>{let e=(0,v.useRef)(null),[n,a]=(0,v.useState)(!1);async function setup(){a(!0),function(){for(var n;null===(n=e.current)||void 0===n?void 0:n.firstChild;)e.current.removeChild(e.current.firstChild)}();try{var n;d=new _.xsS,c=new _.SUY,m=new E._,h=new N.k,(l=new _.CP7).setPixelRatio(window.devicePixelRatio),l.setSize(r,s),l.setClearColor(16777215,1),l.shadowMap.enabled=!0,null===(n=e.current)||void 0===n||n.appendChild(l.domElement),u=new _.cPb(45,r/s,.1,100),d.add(new _.Mig(16777215,2.2)),(g=new _.Ox3(16769721,2)).position.set(2,4,2),g.castShadow=!0,d.add(g),(p=new _.Kj0(new _._12(10,10,1,1),new _.Tn7({opacity:.2}))).rotation.x=-Math.PI/2,p.receiveShadow=!0,d.add(p),d.add(new _.VLJ(10,20,0,10066329)),d.add(new _.y8_(10)),(w=new A.z(u,l.domElement)).enableDamping=!0,await M()(),await loadModel(),await loadMotion()}catch(e){alert("error occurred!");return}finally{a(!1)}animate()}async function loadModel(){return new Promise((e,n)=>{let a=P[y];if(i[a.name])return e();h.load(a.path,n=>{n.castShadow=!0;let o=new _.ZzF().setFromObject(n);n.scale.multiplyScalar(a.height/o.max.y),n.material.forEach(e=>{e.emissive.multiplyScalar(a.emissiveMag)}),i[a.name]=n,e()},e=>console.info("[model] ".concat(e.loaded/e.total*100,"% loaded")),e=>n(e))})}async function loadMotion(){return new Promise((e,n)=>{var a;let o=P[y],r=F[b];a=i[o.name],f=k.d9(a),h.loadAnimation(r.path,f,a=>{if(m.meshes.length)return e();try{m.add(f,{animation:a,physics:!0})}catch(e){console.error(e),n(e);return}d.add(f),w.target.set(0,o.height/2,0),w.object.position.set(0,.55*o.height,1.9*o.height),e()},e=>console.info("[motion] ".concat(e.loaded/e.total*100,"% loaded")),e=>n(e))})}function animate(){let t=()=>{m.update(c.getDelta()),w.update(),l.render(d,u),o=requestAnimationFrame(t)};t()}async function changeModel(){y=(y+1)%P.length,reset()}async function changeMotion(){b=(b+1)%F.length,reset()}async function reset(){a(!0),m.remove(f),d.remove(f),cancelAnimationFrame(o);try{await loadModel(),await loadMotion()}catch(e){setup();return}finally{a(!1)}animate()}return(0,v.useEffect)(()=>{r=window.innerWidth,s=window.innerHeight,i||(i={}),y||(y=0),b||(b=Math.floor(Math.random()*F.length)),setup()},[]),(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(meta,{title:"tic40/threejs-mmd",description:"tic40/threejs-mmd"}),(0,x.jsx)("div",{className:"absolute top-1/2 left-1/2 animate-ping h-5 w-5 bg-gray-600 rounded-full",role:"status",style:{display:n?"block":"none"}}),(0,x.jsx)("button",{onClick:changeModel,className:"absolute top-2 left-2 bg-transparent hover:text-gray-500 text-gray-700 py-1 px-1 border rounded",disabled:n,children:"Model >>"}),(0,x.jsx)("button",{onClick:changeMotion,className:"absolute top-2 left-24 bg-transparent hover:text-gray-500 text-gray-700 py-1 px-1 border rounded",disabled:n,children:"Motion >>"}),(0,x.jsx)("a",{className:"absolute bottom-2 left-2 bg-transparent text-gray-700 py-1 px-1 noborder rounded",href:"https://github.com/tic40/threejs-mmd",target:"_blank",rel:"noreferrer",children:"GitHub"}),(0,x.jsx)("div",{ref:e})]})}},1756:function(){}},function(e){e.O(0,[737,34,491,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);